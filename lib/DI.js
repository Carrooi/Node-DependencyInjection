// Generated by CoffeeScript 1.6.3
(function() {
  var DI, Helpers, Service,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  Service = require('./Service');

  Helpers = require('./Helpers');

  DI = (function() {
    DI.prototype.services = null;

    DI.prototype.reserved = ['di'];

    function DI() {
      var di;
      di = new Service(this, this);
      di.instantiate = false;
      di.injectMethods = false;
      this.services = {
        di: di
      };
    }

    DI.prototype.addService = function(name, service, args) {
      if (args == null) {
        args = [];
      }
      if (__indexOf.call(this.reserved, name) >= 0) {
        throw new Error("DI: name '" + name + "' is reserved by DI.");
      }
      this.services[name] = new Service(this, service, args);
      return this.services[name];
    };

    DI.prototype.autowireArguments = function(method, args) {
      if (args == null) {
        args = [];
      }
      console.log('Method autowireArguments is deprecated, use the same method in Helpers class.');
      return Helpers.autowireArguments(method, args, this);
    };

    DI.prototype.createInstance = function(service, args, instantiate, injectMethods) {
      var method;
      if (args == null) {
        args = [];
      }
      if (instantiate == null) {
        instantiate = true;
      }
      if (injectMethods == null) {
        injectMethods = true;
      }
      if (instantiate === true) {
        service = Helpers.createInstance(service, args, this);
      }
      if (Object.prototype.toString.call(service) === '[object Object]' && injectMethods) {
        for (method in service) {
          if (method.match(/^inject/) !== null) {
            this.inject(service[method], service);
          }
        }
      }
      return service;
    };

    DI.prototype.inject = function(fn, scope) {
      var args;
      if (scope == null) {
        scope = {};
      }
      if (!(fn instanceof Function)) {
        throw new Error('DI: Inject method can be called only on functions.');
      }
      args = Helpers.autowireArguments(fn, [], this);
      return fn.apply(scope, args);
    };

    DI.prototype.hasDefinition = function(name) {
      return typeof this.services[name] !== 'undefined';
    };

    DI.prototype.findDefinitionByName = function(name, need) {
      if (need == null) {
        need = true;
      }
      if (!this.hasDefinition(name)) {
        if (need === true) {
          throw new Error("DI: Service '" + name + "' was not found.");
        } else {
          return null;
        }
      }
      return this.services[name];
    };

    DI.prototype.getByName = function(name) {
      console.log('DI: Method getByName is deprecated, use get method.');
      return this.get(name);
    };

    DI.prototype.get = function(name) {
      return this.findDefinitionByName(name).getInstance();
    };

    DI.prototype.create = function(name) {
      return this.findDefinitionByName(name).create();
    };

    DI.prototype.getFactory = function(name) {
      var _this = this;
      return function() {
        return _this.findDefinitionByName(name).create();
      };
    };

    return DI;

  })();

  module.exports = DI;

}).call(this);
